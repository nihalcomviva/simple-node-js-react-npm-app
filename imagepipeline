pipeline {
    agent any

    environment {
        DOCKER_REGISTRY = 'localhost:5000'
        DOCKER_CREDENTIALS_ID = 'local-docker-registry'
    }

    stages {
        stage('Pull, Tag, and Push Images') {
            steps {
                script {
                    def images = [
                        "postgres:latest",
                        "redis:latest",
                        "mongo:latest",
                        "mongo-express:latest"
                    ]

                    def customNames = [
                        "postgres:latest": "my-postgres:latest",
                        "redis:latest": "my-redis:latest",
                        "mongo:latest": "my-mongo:latest",
                        "mongo-express:latest": "updated-mongo-express-image:latest"
                    ]

                    withCredentials([usernamePassword(credentialsId: DOCKER_CREDENTIALS_ID, usernameVariable: 'DOCKER_USERNAME', passwordVariable: 'DOCKER_PASSWORD')]) {
                        images.each { image ->
                            def customName = customNames[image]
                            sh "docker pull ${image}"
                            sh "docker tag ${image} ${DOCKER_REGISTRY}/${customName}"
                            sh "docker push ${DOCKER_REGISTRY}/${customName}"
                        }
                    }
                }
            }
        }
    }
}

